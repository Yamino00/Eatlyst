<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title>Registrati su Eatlyst</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="register-content">
  <div class="register-container">
    <!-- Logo e Welcome -->
    <div class="welcome-section">
      <div class="logo">
        <h1>üçΩÔ∏è Eatlyst</h1>
      </div>
      <p class="welcome-text">Unisciti a noi per iniziare a pianificare i tuoi pasti!</p>
    </div>

    <!-- Register Form -->
    <ion-card class="register-card">
      <ion-card-header>
        <ion-card-title>Crea il tuo account</ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
          <!-- Nome -->
          <ion-item fill="outline" class="register-item">
            <ion-icon name="person-outline" slot="start"></ion-icon>
            <ion-label position="stacked">Nome</ion-label>
            <ion-input 
              type="text" 
              formControlName="firstName"
              placeholder="Inserisci il tuo nome"
              [class.ion-invalid]="firstName?.touched && firstName?.invalid"
              [class.ion-valid]="firstName?.touched && firstName?.valid">
            </ion-input>
          </ion-item>
          <div class="error-message" *ngIf="firstName?.touched && firstName?.invalid">
            <ion-text color="danger" *ngIf="firstName?.errors?.['required']">
              Il nome √® richiesto
            </ion-text>
            <ion-text color="danger" *ngIf="firstName?.errors?.['minlength']">
              Il nome deve essere di almeno 2 caratteri
            </ion-text>
          </div>

          <!-- Cognome -->
          <ion-item fill="outline" class="register-item">
            <ion-icon name="person-outline" slot="start"></ion-icon>
            <ion-label position="stacked">Cognome</ion-label>
            <ion-input 
              type="text" 
              formControlName="lastName"
              placeholder="Inserisci il tuo cognome"
              [class.ion-invalid]="lastName?.touched && lastName?.invalid"
              [class.ion-valid]="lastName?.touched && lastName?.valid">
            </ion-input>
          </ion-item>
          <div class="error-message" *ngIf="lastName?.touched && lastName?.invalid">
            <ion-text color="danger" *ngIf="lastName?.errors?.['required']">
              Il cognome √® richiesto
            </ion-text>
            <ion-text color="danger" *ngIf="lastName?.errors?.['minlength']">
              Il cognome deve essere di almeno 2 caratteri
            </ion-text>
          </div>

          <!-- Email -->
          <ion-item fill="outline" class="register-item">
            <ion-icon name="mail-outline" slot="start"></ion-icon>
            <ion-label position="stacked">Email</ion-label>
            <ion-input 
              type="email" 
              formControlName="email"
              placeholder="Inserisci la tua email"
              [class.ion-invalid]="email?.touched && email?.invalid"
              [class.ion-valid]="email?.touched && email?.valid">
            </ion-input>
          </ion-item>
          <div class="error-message" *ngIf="email?.touched && email?.invalid">
            <ion-text color="danger" *ngIf="email?.errors?.['required']">
              L'email √® richiesta
            </ion-text>
            <ion-text color="danger" *ngIf="email?.errors?.['email']">
              Inserisci un'email valida
            </ion-text>
          </div>

          <!-- Password -->
          <ion-item fill="outline" class="register-item">
            <ion-icon name="lock-closed-outline" slot="start"></ion-icon>
            <ion-label position="stacked">Password</ion-label>
            <ion-input 
              [type]="showPassword ? 'text' : 'password'" 
              formControlName="password"
              placeholder="Inserisci una password sicura"
              [class.ion-invalid]="password?.touched && password?.invalid"
              [class.ion-valid]="password?.touched && password?.valid">
            </ion-input>
            <ion-icon 
              [name]="showPassword ? 'eye-off-outline' : 'eye-outline'" 
              slot="end" 
              (click)="togglePasswordVisibility()"
              class="password-toggle">
            </ion-icon>
          </ion-item>
          <div class="error-message" *ngIf="password?.touched && password?.invalid">
            <ion-text color="danger" *ngIf="password?.errors?.['required']">
              La password √® richiesta
            </ion-text>
            <ion-text color="danger" *ngIf="password?.errors?.['minlength']">
              La password deve essere di almeno 8 caratteri
            </ion-text>
            <ion-text color="danger" *ngIf="password?.errors?.['pattern']">
              La password deve contenere almeno una lettera maiuscola, una minuscola e un numero
            </ion-text>
          </div>

          <!-- Conferma Password -->
          <ion-item fill="outline" class="register-item">
            <ion-icon name="lock-closed-outline" slot="start"></ion-icon>
            <ion-label position="stacked">Conferma Password</ion-label>
            <ion-input 
              [type]="showConfirmPassword ? 'text' : 'password'" 
              formControlName="confirmPassword"
              placeholder="Conferma la tua password"
              [class.ion-invalid]="confirmPassword?.touched && confirmPassword?.invalid"
              [class.ion-valid]="confirmPassword?.touched && confirmPassword?.valid">
            </ion-input>
            <ion-icon 
              [name]="showConfirmPassword ? 'eye-off-outline' : 'eye-outline'" 
              slot="end" 
              (click)="toggleConfirmPasswordVisibility()"
              class="password-toggle">
            </ion-icon>
          </ion-item>
          <div class="error-message" *ngIf="confirmPassword?.touched && confirmPassword?.invalid">
            <ion-text color="danger" *ngIf="confirmPassword?.errors?.['required']">
              La conferma password √® richiesta
            </ion-text>
          </div>
          <div class="error-message" *ngIf="registerForm.errors?.['passwordMismatch'] && confirmPassword?.touched">
            <ion-text color="danger">
              Le password non corrispondono
            </ion-text>
          </div>

          <!-- Terms and Conditions -->
          <div class="terms-section">
            <ion-checkbox formControlName="acceptTerms" labelPlacement="end">
              Accetto i <ion-button fill="clear" size="small" (click)="showTerms()">termini e condizioni</ion-button> e la <ion-button fill="clear" size="small" (click)="showPrivacyPolicy()">privacy policy</ion-button>
            </ion-checkbox>
          </div>
          <div class="error-message" *ngIf="acceptTerms?.touched && acceptTerms?.invalid">
            <ion-text color="danger">
              Devi accettare i termini e condizioni per procedere
            </ion-text>
          </div>

          <!-- Register Button -->
          <ion-button 
            expand="block" 
            type="submit" 
            [disabled]="isLoading || registerForm.invalid"
            class="register-button">
            <ion-spinner name="crescent" *ngIf="isLoading"></ion-spinner>
            <span *ngIf="!isLoading">Crea Account</span>
          </ion-button>
        </form>

        <!-- Divider -->
        <div class="divider">
          <span>oppure</span>
        </div>

        <!-- Google Register -->
        <ion-button 
          expand="block" 
          fill="outline" 
          (click)="signUpWithGoogle()"
          [disabled]="isLoading"
          class="google-button">
          <ion-icon name="logo-google" slot="start"></ion-icon>
          Registrati con Google
        </ion-button>

        <!-- Login Link -->
        <div class="login-link">
          <ion-text>
            Hai gi√† un account? 
            <ion-button fill="clear" size="small" (click)="goToLogin()">
              Accedi
            </ion-button>
          </ion-text>
        </div>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
